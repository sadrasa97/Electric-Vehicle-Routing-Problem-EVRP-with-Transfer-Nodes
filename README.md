
# Electric Vehicle Routing Problem (EVRP) with Transfer Nodes

## Overview

This project addresses the Electric Vehicle Routing Problem (EVRP) with transfer nodes, where electric vehicles (EVs) must pick up and deliver goods while considering battery constraints, time windows, and the possibility of transferring goods between vehicles at designated transfer nodes. The model is implemented using Pyomo, a Python-based optimization modeling language, and solved using the GLPK solver.

## Features

- **Pickup and Delivery**: Vehicles pick up goods from designated pickup nodes and deliver them to corresponding delivery nodes.
- **Transfer Nodes**: Vehicles can transfer goods at specific transfer nodes, allowing for more flexible routing.
- **Battery Constraints**: Each vehicle has a limited battery capacity, and the model ensures that vehicles do not exceed this capacity while traveling between nodes.
- **Time Windows**: The model incorporates time windows for pickups and deliveries, ensuring that vehicles arrive within specified time frames.
- **Heuristic Algorithm**: A hybrid heuristic algorithm is implemented to improve the initial solution generated by the optimization model.

## Requirements

- Python 3.x
- Pyomo
- GLPK solver
- NumPy
- Logging

## Installation

1. **Clone the repository**:
   ```bash
   git clone https://github.com/sadrasa97/evrp.git
   cd evrp
   ```

2. **Install required packages**:
   You can install the required Python packages using pip:
   ```bash
   pip install pyomo numpy
   ```

3. **Install GLPK**:
   If you are using a Debian-based system (like Ubuntu), you can install GLPK using:
   ```bash
   sudo apt-get install glpk-utils
   ```

4. **Verify GLPK installation**:
   Check if GLPK is installed correctly:
   ```bash
   which glpsol
   ```

## Usage

1. **Run the model**:
   You can run the model by executing the main script in your Google Colab notebook.

2. **Output**:
   The script will output the results of the optimization, including:
   - The routes taken by each vehicle.
   - The cost associated with the solution.
   - Feasibility checks for the initial and best solutions.

## Model Structure

### Data Definition

The model defines various sets and parameters, including:
- **Nodes**: Pickup, delivery, and transfer nodes.
- **Vehicles**: Different types of vehicles with specific capacities and battery constraints.
- **Costs and Times**: Travel costs and times between nodes.

### Decision Variables

The model includes decision variables for:
- Vehicle routes (binary variables indicating whether a vehicle travels between two nodes).
- Battery levels and charging times.
- Arrival and departure times at each node.

### Objective Function

The objective function minimizes the total cost of the routes while considering waiting times and other constraints.

### Constraints

The model includes various constraints to ensure:

1. **Depot Constraints**:
   - **Leave Depot**: Each vehicle must leave its origin depot exactly once.
   - **Return to Depot**: Each vehicle must return to its destination depot exactly once.

2. **Flow Constraints**:
   - If a vehicle enters a node, it must leave that node. This ensures that vehicles do not get "stuck" at any node.

3. **Pickup and Delivery Constraints**:
   - Each request must be picked up from its designated pickup node and delivered to its corresponding delivery node.

4. **Transfer Constraints**:
   - If a request is transferred between vehicles at a transfer node, the arrival time of the pickup vehicle must be earlier than the departure time of the delivery vehicle.

5. **Time Constraints**:
   - Arrival times at pickup nodes must be within specified time windows.
   - Departure times from delivery nodes must also adhere to time windows.

6. **Battery Constraints**:
   - Vehicles must not exceed their battery capacity while traveling between nodes.
   - Battery levels are updated based on travel times and charging at transfer nodes.

7. **Capacity Constraints**:
   - Ensure that the load carried by each vehicle does not exceed its capacity.

8. **Precedence Constraints**:
   - Ensure that each vehicle visits pickup nodes before their corresponding delivery nodes.

9. **No Loop Constraints**:
   - Prevent vehicles from traveling in loops between nodes.

10. **Charging Constraints**:
    - Vehicles must visit transfer nodes to recharge, and charging cannot exceed battery capacity.

## Heuristic Algorithm

A hybrid heuristic algorithm is implemented to improve the initial solution generated by the optimization model. The algorithm includes various neighborhood structures for exploring potential solutions, such as:
- Single and double swaps of pickup and delivery nodes.
- Merging pickup and delivery nodes into the same route.
- Small destroy and repair operations to optimize routes.

## Contributing

Contributions are welcome! If you have suggestions for improvements or new features, please open an issue or submit a pull request.


## Acknowledgments

- Pyomo for optimization modeling.
- GLPK for solving linear programming problems.
- The open-source community for their contributions and support.
